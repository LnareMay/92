<!DOCTYPE html>
<html lang="ko-KR" xmlns:th="http://www.thymeleaf.org">
<head>
 	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<head  th:insert="~{layouts/meta_tag :: headMeta}"></head>
    <title>체육관 예약 시스템</title>
    <!-- 공통 css -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.3/litera/bootstrap.min.css"
		integrity="sha512-TUtnNUXMMWp2IALAR9t2z1vuorOUQL4dPWG3J9ANInEj6xu/rz5fzni/faoEGzuqeY1Z1yGD6COYAW72oiDVYA=="
		crossorigin="anonymous" referrerpolicy="no-referrer" />
		<link rel="stylesheet" th:href="@{/css/common.css}">
		<!-- Linking CSS files -->
		<link rel="stylesheet" th:href="@{/css/detail_hj.css}"/>
		<link rel="stylesheet" th:href="@{/css/detail_yj.css}"/>
		
	<!--flatpickr -->
 	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    
    <!-- 공통 js -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
	integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
	crossorigin="anonymous"></script>
	
	<!--flatpickr -->
	<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
	<script src="https://npmcdn.com/flatpickr/dist/l10n/ko.js"></script>
	
	<style>	
	  /* 폼 스타일 */
	  .booking-form {
	    width: 100%; /* 반응형 너비 */
	    padding: 20px; /* 내부 여백 */
	    background-color: #f8f9fa; /* 연한 회색 배경 */
	    border-radius: 10px; /* 모서리 둥글게 */
	    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* 그림자 효과 */
	  }
	
	  .form-group {
	    margin-bottom: 15px;
	  }
	
	  .form-group label {
	    font-weight: bold;
	    display: inline-block;
	    vertical-align: top;
	  }
	
	  .form-group span {
	    display: inline-block;
	    color: #333;
	    font-size: 14px;
	    line-height: 1.5;
	    white-space: pre-line; /* 줄바꿈 유지 */
	  }
	
	
	  .booking-form button {
	    background-color: #007bff; /* 파란색 배경 */
	    color: white;
	    padding: 10px 20px;
	    border: none;
	    border-radius: 5px; /* 버튼 둥글게 */
	    cursor: pointer;
	  }
	
	  .booking-form button:hover {
	    background-color: #0056b3; /* 어두운 파란색 배경 */
	  }


	  /* Carousel 컨테이너 높이 설정 */
	  .carousel-inner {
	    max-height: 500px; /* 원하는 고정 높이 */
	    overflow: hidden; /* 초과 이미지를 숨김 */ 
	    display: flex
	  }
	
	  /* Carousel 이미지 스타일 */
	  .carousel-item img {
	    width: 100%; /* 컨테이너 너비에 맞춤 */
	    height: 100%; /* 컨테이너 높이에 맞춤 */
	  	/* 이미지 비율을 유지하며 컨테이너 내에 맞춤 */
	   /*  object-position: center; */  /* 이미지를 중앙에 위치  */
	  }
	  

	  
	</style>
</head>
	<!-- Header -->
	<div th:insert="~{layouts/header :: header}"></div>
<body>
<div class="container my-4">
	<a th:href="@{/facility/main}" class="more-link"> ◀시설예약목록 </a>
    <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
	  <div class="carousel-indicators">
	    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
	    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
	    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
	    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="3" aria-label="Slide 4"></button>
	  </div>
	  <div class="carousel-inner">
	    <div class="carousel-item active" data-bs-interval="5000">
	      <img th:src="|/view/${facility.facilityImage1}|" id="facilityImage1"  alt="Product Image">
	    </div>
	    <div class="carousel-item" data-bs-interval="5000">
	       <img th:src="|/view/${facility.facilityImage2}|" id="facilityImage2"  alt="Product Image">
	    </div>
	    <div class="carousel-item" data-bs-interval="5000">
	       <img th:src="|/view/${facility.facilityImage3}|" id="facilityImage3"  alt="Product Image">
	    </div>
	    <div class="carousel-item" data-bs-interval="5000">
	       <img th:src="|/view/${facility.facilityImage4}|" id="facilityImage4" alt="Product Image">
	    </div>
	  </div>
	  <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
	    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
	    <span class="visually-hidden">Previous</span>
	  </button>
	  <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
	    <span class="carousel-control-next-icon" aria-hidden="true"></span>
	    <span class="visually-hidden">Next</span>
	  </button>
	</div>

	<div style="padding-top:10px;">
		<!-- 예약 form start  -->
	    <form class="booking-form" action="/facility/submit-booking" method="POST">
		
		<div th:if="${facility.facilityIsOnlyClub}" style="color: red; font-weight: bold;"><span>✅ 해당 시설은 클럽장만 예약할 수 있는 시설입니다</span></div></br>
	    
	    <div class="form-group">
		    <label for="memId">예약자ID: </label>
		    <span id="memId" name="memId" th:text="${userId}"></span>
		    <input type="hidden" id="memId" name="memId" th:value="${userId}">
		    
	     </div>
	     
 		<div class="form-group">
    	 <label for="reservationDate">예약 날짜</label>
    	 <input id="reservationDate" name="reservationDate" type="date" placeholder="날짜를 선택하세요" required>
		</div>
		
		<div class="form-group">
	      <label for="reservationTime">예약 시간</label>
		  <select id="reservationStartTime" name="reservationStartTime" type="time" required></select>
		  <select id="reservationEndTime" name="reservationEndTime" type="time" required></select>
    	  <!-- 옵션이 JavaScript로 동적으로 추가됩니다 -->
    	  
	      <label for="count">예약 인원</label>
	      <input type="number" id="count" name="count" placeholder="예약 인원을 입력해주세요." required>
		</div>
		
		
	      <div class="form-group">
	      	<label for="price">시간 당 이용 요금(1hour):</label>
	      	<span th:text="${facility.formattedPrice}"></span>원
	      	<input type="hidden" id="price" name="price" th:value="${facility.price}">
	      </div>
	       <hr />
	       <!-- 시설명  -->
	        <div class="form-group">
	           <label for="facilityName">시설명:</label>
	           <span th:text="${facility.facilityName}"></span>
	           <input type="hidden" id="facilityName" name="facilityName" th:value="${facility.facilityName}">
	            <input type="hidden" id="facilityCode" name="facilityCode" th:value="${facility.facilityCode}">
			</div>
			<!-- 시설 주소  -->
			<div class="form-group">
		        <label for="facilityAddress">시설 주소: </label>
		        <span th:text="${facility.facilityAddress}"></span>
	         </div>
			<div class="form-group">
		        <label for="facilityDescription">이용안내: </label>
		        <span style="white-space: pre-line;" th:text="${facility.facilityDescription}"></span>
	         </div>
	         <!-- 시설 운영 시간 -->
	        	<div class="form-group">
		         <label for="facilityTime">운영 시간:</label>
	          	 <span th:text="${facility.facilityStartTime + ' ~ ' + facility.facilityEndTime}"></span>
	        </div>
	    

	        <button th:if="${!facility.facilityIsOnlyClub}" type="submit" >예약하기</button>
	        <button th:if="${facility.facilityIsOnlyClub && isClubOwner}" type="submit" >예약하기</button>
	        
	    </form>
    </div>
</div>

	<!-- Footer -->
	<div th:insert="~{layouts/footer :: footer}"></div>
	
    <script>
        // 날짜 선택 Flatpickr 초기화
        flatpickr("#reservationDate", {
            dateFormat: "Y-m-d", // 날짜 형식 (YYYY-MM-DD)
            minDate: "today", // 오늘 이후만 선택 가능
            allowInput: true, // 사용자가 직접 입력 가능
            locale: "ko" // 한국어 설정
        });

    </script>
    
<script th:inline="javascript">

    // 서버에서 전달받은 운영 시간 (Thymeleaf 변수 사용)
    const facilityStartTime =  /*[[${facility.facilityStartTime}]]*/"9:00";	//서버에서 받지 못했을 때 기본 값 9:00
    const facilityEndTime =  /*[[${facility.facilityEndTime}]]*/"22:00"; //서버에서 받지 못했을 때 기본 값 22:00
    
 // 운영 시간 기반으로 예약 가능한 시간 생성 <예약 시작 시간>
    function generateReservationStartTimes(startTime, endTime) {
        const startSelect = document.getElementById("reservationStartTime");
        const start = new Date(`1970-01-01T${startTime}`);
        const end = new Date(`1970-01-01T${endTime}`);
        const interval = 60; // 60분 간격

        startSelect.innerHTML = ""; // 기존 옵션 제거

        while (start < end) {
            const timeString = start.toTimeString().slice(0, 5); // HH:MM 형식
            const option = document.createElement("option");
            option.value = timeString;
            option.textContent = timeString;
            startSelect.appendChild(option);
            start.setMinutes(start.getMinutes() + interval); // 60분 간격으로 증가
        }
    }

    // 운영 시간 기반으로 예약 가능한 시간 생성 <예약 종료 시간>
    function generateReservationEndTimes(selectedStartTime, endTime) {
        const endSelect = document.getElementById("reservationEndTime");
        const start = new Date(`1970-01-01T${selectedStartTime}`);
        const end = new Date(`1970-01-01T${endTime}`);
        const interval = 60; // 60분 간격

        endSelect.innerHTML = ""; // 기존 옵션 제거

        while (start < end) {
            start.setMinutes(start.getMinutes() + interval); // 60분 추가
            // if (start >= end) break; // 종료 시간이 운영 시간을 초과하면 중지

            const timeString = start.toTimeString().slice(0, 5); // HH:MM 형식
            const option = document.createElement("option");
            option.value = timeString;
            option.textContent = timeString;
            endSelect.appendChild(option);
        }
    }

    // 이벤트 연결
    document.getElementById("reservationStartTime").addEventListener("change", function () {
        const selectedStartTime = this.value; // 선택된 시작 시간
        generateReservationEndTimes(selectedStartTime, facilityEndTime); // 종료 시간 생성
    });

    // 초기 시간 목록 생성
    generateReservationStartTimes(facilityStartTime, facilityEndTime);
    document.getElementById("reservationStartTime").dispatchEvent(new Event("change"));

    
    
</script>
	
	
</body>

</html>