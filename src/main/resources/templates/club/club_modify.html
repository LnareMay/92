<!DOCTYPE html>
<html lang="ko-KR" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- meta_tag include -->
    <head th:insert="~{layouts/meta_tag :: headMeta}"></head>
    <title>클럽 수정</title>

    <!-- 공통 css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.3/litera/bootstrap.min.css" integrity="sha512-TUtnNUXMMWp2IALAR9t2z1vuorOUQL4dPWG3J9ANInEj6xu/rz5fzni/faoEGzuqeY1Z1yGD6COYAW72oiDVYA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" th:href="@{/css/common.css}">
    <!-- 여기에 본인 css 작성해주세요 (detail_hj.css) -->
    <!-- Linking CSS files -->
    <link rel="stylesheet" th:href="@{/css/detail_hj.css}"/>
    <link rel="stylesheet" th:href="@{/css/detail_yj.css}"/>

    <!-- 공통 js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
   
</head>
<body>
    <div th:insert="~{layouts/header :: header}"></div>
    
    <main class="container main" style="margin: 15px auto 0 auto;">
    
        <form id="clubmodify" action="/club/modify" method="post" enctype="multipart/form-data">
            <input type="hidden" name="clubCode" id="clubCode" th:value="${clubdto.clubCode}"/>
            
            <label for="club-name">클럽명	</label>
            	<input type="text" name="clubName" id="clubName" th:value="${clubdto.clubName}" ></input>
            	
            <label for="club-name">클럽방장</label>
            	<input type="text" name="memId" id="memId" th:value="${#authentication.principal.MEM_ID}" readonly></input>

		    <label for="club-exercise">선호 운동 코드</label>
				<div class="exercise-container">
				    <div class="exercise-selection">
				       <input type="hidden" id="clubExercise" name="clubExercise" th:value="${clubdto.clubExercise}" />				
					        <button type="button" onclick="selectExercise(this)" value="EXE_BADMINTON">배드민턴</button>
					        <button type="button" onclick="selectExercise(this)" value="EXE_BASEBALL">야구</button>
				            <button type="button" onclick="selectExercise(this)" value="EXE_BASKET">농구</button>
				            <button type="button" onclick="selectExercise(this)" value="EXE_CLIMB">암벽등반</button>
				            <button type="button" onclick="selectExercise(this)" value="EXE_FOOTBALL">축구</button>
				            <button type="button" onclick="selectExercise(this)" value="EXE_FUTSAL">풋살</button>
				            <button type="button" onclick="selectExercise(this)" value="EXE_FITNESS">헬스</button>
				            <button type="button" onclick="selectExercise(this)" value="EXE_MOUNT">등산</button>
				            <button type="button" onclick="selectExercise(this)" value="EXE_PILATES">필라테스</button>
				            <button type="button" onclick="selectExercise(this)" value="EXE_TENNIS">테니스</button>
				            <button type="button" onclick="selectExercise(this)" value="EXE_YOGA">요가</button>
			        </div>
			    </div>		    
			    		    
			<label for="club-theme">클럽 테마</label>
	           	<div class="theme-container">
				    <div class="theme-selection">
				    	<input type="hidden" id="clubTheme" name="clubTheme" th:value="${clubdto.clubTheme}" />	
							<button type="button" onclick="selectTheme(this)" value="THM_SPORTCLUB"
										th:classappend="${clubdto.clubTheme.contains('THM_SPORTCLUB') ? 'selected' : ''}">운동클럽</button>
							<button type="button" onclick="selectTheme(this)" value="THM_SPORTJOURNAL"
										th:classappend="${clubdto.clubTheme.contains('THM_SPORTJOURNAL') ? 'selected' : ''}">운동일지</button>
							<button type="button" onclick="selectTheme(this)" value="THM_FOOD"
										th:classappend="${clubdto.clubTheme.contains('THM_FOOD') ? 'selected' : ''}">영양제/식단</button>
							<button type="button" onclick="selectTheme(this)" value="THM_FITNESS"
										th:classappend="${clubdto.clubTheme.contains('THM_FITNESS') ? 'selected' : ''}">헬스</button>
							<button type="button" onclick="selectTheme(this)" value="THM_DIET"
										th:classappend="${clubdto.clubTheme.contains('THM_DIET') ? 'selected' : ''}">체중감량</button>
							<button type="button" onclick="selectTheme(this)" value="THM_BODYPROFILE"
										th:classappend="${clubdto.clubTheme.contains('THM_BODYPROFILE') ? 'selected' : ''}">바디프로필</button>
							<button type="button" onclick="selectTheme(this)" value="THM_RECOVER"
										th:classappend="${clubdto.clubTheme.contains('THM_RECOVER') ? 'selected' : ''}">부상/재활</button>
							<button type="button" onclick="selectTheme(this)" value="THM_CONTEST"
										th:classappend="${clubdto.clubTheme.contains('THM_CONTEST') ? 'selected' : ''}">대회준비</button>
							<button type="button" onclick="selectTheme(this)" value="THM_EXAM"
										th:classappend="${clubdto.clubTheme.contains('THM_EXAM') ? 'selected' : ''}">입시준비</button>
				    </div>
				</div>

            <label for="club-description">클럽 소개</label>
            	<div class="club-intro-container">
              	  <textarea name="clubIntroduction" id="clubIntroduction" maxlength="500" rows="5" th:text="${clubdto.clubIntroduction}"></textarea>
				</div>
            
           	<!-- 사진 추가 -->
            <label for="club-image">대표 이미지</label>
			 <div class="club-image-container">
			    <div class="club-image-upload">
			 		<label for="clubImage1">   	
					   <img id="photo-upload-1" th:src="${clubdto.clubImage1 != null ? '/view/' + clubdto.clubImage1 : '/img/plus_icon.png'}"
					   							th:classappend="${clubdto.clubImage1 == null ? 'default-icon' : ''}"alt="대표이미지1">
			        </label>
			      <!-- <button type="button" class="delete-btn" onclick="removeImage('clubImage1', 'photo-upload-1')">X</button> -->
			       <input id="clubImage1" name="files" type="file" accept="image/*" onchange="uploadAndPreviewImage(event, 'photo-upload-1')" style="display: none;">
			    </div>
			    <div class="club-image-upload">
			 		<label for="clubImage2">   	
					   <img id="photo-upload-2" th:src="${clubdto.clubImage2 != null ? '/view/' + clubdto.clubImage2 : '/img/plus_icon.png'}"  
												th:classappend="${clubdto.clubImage2 == null ? 'default-icon' : ''}"alt="대표이미지2">
			        </label>
			          <input id="clubImage2" name="files" type="file" accept="image/*" onchange="uploadAndPreviewImage(event, 'photo-upload-2')" style="display: none;">
			    </div>
			    <div class="club-image-upload">
			    	<label for="clubImage3">   	
					   <img id="photo-upload-3" th:src="${clubdto.clubImage3 != null ? '/view/' + clubdto.clubImage3 : '/img/plus_icon.png'}"  
					   							th:classappend="${clubdto.clubImage3 == null ? 'default-icon' : ''}"alt="대표이미지3">
			        </label>
			           <input id="clubImage3" name="files" type="file" accept="image/*" onchange="uploadAndPreviewImage(event, 'photo-upload-3')" style="display: none;">
			    </div>
			    
			    <div class="club-image-upload">
			   	 	<label for="clubImage4">   	
			           <img id="photo-upload-4" th:src="${clubdto.clubImage4 != null ? '/view/' + clubdto.clubImage4 : '/img/plus_icon.png'}"  
					   							th:classappend="${clubdto.clubImage4 == null ? 'default-icon' : ''}"alt="대표이미지4">
			        </label>
			        <input id="clubImage4" name="files" type="file" accept="image/*" onchange="previewImage(event, 'photo-upload-4')" style="display: none;" />
			    </div>
			</div>
			
			<!-- 주활동지역 -->
			<label class="form-label">주활동지역</label>
				<input type="hidden" id="clubAddress" name="clubAddress" th:value="${clubdto.clubAddress}">
			
		<div class="form-row">
            	<select id="city" class="form-select" onchange="selectDistricts(); selectAddress()">
					<option value="">=== 도 선택 ===</option>
					<option value="서울특별시">서울특별시</option> 
					<option value="경기도">경기도</option>
					<option value="강원도">강원도</option>
					<option value="충청북도">충청북도</option>
					<option value="충청남도">충청남도</option>
					<option value="전북특별자치도">전북특별자치도</option>
					<option value="전라남도" >전라남도</option>
					<option value="경상북도" >경상북도</option>
					<option value="경상남도" >경상남도</option>
					<option value="부산광역시" >부산광역시</option>
					<option value="대구광역시" >대구광역시</option>
					<option value="인천광역시" >인천광역시</option>
					<option value="광주광역시" >광주광역시</option>
					<option value="대전광역시" >대전광역시</option>
					<option value="울산광역시" >울산광역시</option>
					<option value="세종특별자치시" >세종특별자치시</option>
					<option value="제주특별자치도" >제주특별자치도</option>
				</select>
				
	        	<select id="district" class="form-select" onchange="selectAddress()">
					<option value="">=== 구 선택 ===</option>
					<option th:each="dist : ${districts}" th:value="${dist}" th:text="{dist}" th:selected="${dist==district}"></option>
	        	</select>
		</div>
		
			<!-- 클럽 공개여부 / 비밀번호 -->
			<label for="club-isprivate">클럽 공개여부</label>
			<div class="club-isprivate">
				    <input type="radio" id="clubIsprivateNo" name="clubIsprivate" th:value="false" 
				    	   th:checked="${!clubdto.clubIsprivate}" onchange="togglePasswordField()" /> 공개
				    <input type="radio" id="clubIsprivateYes" name="clubIsprivate" th:value="true" onchange="togglePasswordField()" 
				    	   th:checked="${clubdto.clubIsprivate}" /> 비공개
				    <input type="password" id="clubPw" name="clubPw" th:value="${clubdto.clubPw}" 
				    	   th:style="${clubdto.clubIsprivate ? '' : 'display: none;'}" style="margin-left: 10px;">
			</div>

			<button type="submit" class="btn btn-primary mt-4" style="margin-bottom: 20px;">수정하기</button>	
            <button type="reset" class="btn btn-secondary mt-4" style="margin-bottom: 20px;">새로고침</button>
            <!-- <button type="button" class="btn btn-warning delete-btn" id="delete-btn">클럽 삭제하기</button> -->

        </form>
        </main>
    <div th:insert="~{layouts/footer :: footer}"></div>
</body>
 <script> 
		document.addEventListener("DOMContentLoaded", function () {
			const selectedExercise = document.getElementById('clubExercise').value;
			const exercisebuttons = document.querySelectorAll('.exercise-selection button');
			
			exercisebuttons.forEach(button => {
				if(button.value === selectedExercise) {
					button.classList.add('selected');
				}
			});
			
		    const addressInput = document.getElementById("clubAddress");
		    const currentAddress = addressInput.value.trim();

		    if (currentAddress) {
		        const [city, district] = currentAddress.split(" ");

		        const citySelect = document.getElementById("city");
		        const districtSelect = document.getElementById("district");

		        // 시(city) 초기화
		        if (city) {
		            Array.from(citySelect.options).forEach(option => {
		                if (option.text === city) {
		                    option.selected = true;
		                }
		            });
		            selectDistricts();
		        }

		        // 구(district) 초기화
		        if (district) {
		            selectDistricts(); // 동적으로 구 옵션 로드
		            Array.from(districtSelect.options).forEach(option => {
		                if (option.text === district) {
		                    option.selected = true;
		                }
		            });
		        }
		    }
		});
     // 선호운동 버튼
    function selectExercise(button) {
        document.getElementById('clubExercise').value = button.value;

        const exercisebuttons = document.querySelectorAll('.exercise-selection button');
        exercisebuttons.forEach(btn => btn.classList.remove('selected'));
        button.classList.add('selected');
    }
    
    // 운동테마 버튼
	function selectTheme(button) {
	    const themevalue = document.getElementById('clubTheme'); 
	    let selectedThemes = themevalue.value ? themevalue.value.split(',') : [];

	    if (button.classList.contains('selected')) {
	        selectedThemes = selectedThemes.filter(theme => theme !== button.value);
	        button.classList.remove('selected');
	    } else {
	        selectedThemes.push(button.value);
	        button.classList.add('selected');
	    }
	    themevalue.value = selectedThemes.join(',');
	}
	
    // 클럽 공개여부 비밀번호
    function togglePasswordField() {
        const isPrivate = document.getElementById('clubIsprivateYes').checked;
        const passwordField = document.getElementById('clubPw');
        if (isPrivate) {
            passwordField.style.display = 'inline-block'; 
        } else {
            passwordField.style.display = 'none'; 
            passwordField.value= '';
        }
    }
	    
    // 클럽 이미지 업로드
	function uploadAndPreviewImage(event, targetId) {
	    const fileInput = event.target;
	    const file = fileInput.files[0];

	    if (file) {
	        const reader = new FileReader();
	        reader.onload = function (e) {
	            const preview = document.getElementById(targetId);
	            preview.src = e.target.result; // 미리보기 이미지 업데이트
	            
	            preview.classList.remove("default-icon");
	        };
	        reader.readAsDataURL(file);
	    }

	    // 서버로 파일 전송
	    const formData = new FormData();
	    formData.append("files", file); // 업로드할 파일 추가

	    fetch("/upload", {
	        method: "POST",
	        body: formData
	    })
	        .then(response => response.json())
	        .then(result => {
	            console.log("파일 업로드 성공:", result);
	        })
	        .catch(error => console.error("파일 업로드 실패:", error));
	}
	
	/* 클럽이미지제거
	function removeImage(inputId, imgId) {
		const fileInput = document.getElementById(inputId);
		const image = document.getElementById(imgId);
		
		image.src = "/img/plus_icon.png";
		image.classList.add("default-icon");
		
		fileInput.value = "";
	} */
    
    // 지역선택
	function selectAddress() {
	    const citySelect = document.getElementById("city");
	    const districtSelect = document.getElementById("district");
	    const addressInput = document.getElementById("clubAddress");
	
	    const selectedCity = citySelect.value || "";
	    const selectedDistrict = districtSelect.value || "";
	
	    // 시와 구가 선택되지 않았을 경우 빈 값 처리
	    if (!selectedCity && !selectedDistrict) {
	        addressInput.value = "";
	    } else if (selectedCity && !selectedDistrict) {
	        addressInput.value = selectedCity;
	    } else {
	        addressInput.value = `${selectedCity} ${selectedDistrict}`;
	    }
	
	    console.log("Updated Address: ", addressInput.value); // 업데이트된 값 로그
	}
	
	function selectDistricts() {	
    	const districts = {
    		'서울특별시': ['종로구','중구', '용산구', '성동구', '광진구', '동대문구', '중랑구', '성북구', '강북구', '도봉구', '노원구', '은평구', '서대문구',
						'마포구', '양천구', '강서구', '구로구', '금천구', '영등포구', '동작구', '관악구', '서초구', '강남구', '송파구', '강동구']
		  , '경기도': ['수원시', '성남시', '의정부시', '안양시', '부천시', '광명시', '동두천시', '평택시', '안산시', '고양시', '과천시', '구리시', '남양주시', '오산시', '시흥시', 
		  				'군포시', '의왕시', '하남시', '용인시', '파주시', '이천시', '안성시', '김포시', '화성시', '광주시', '양주시', '포천시', '여주시', '연천군', '가평군', '양평군']
		  , '강원도': ['춘천시', '원주시', '강릉시', '동해시', '태백시', '속초시', '삼척시', '홍청군', '횡성군', '영월군', '평창군', '정선군', '철원군', '화천군', '양구군', '인체군', '고성군', '양양군']		
		  , '충청북도': ['청주시', '충주시', '제천시', '보은군', '옥천군', '영동군', '증평군', '진천군', '괴산군', '음성군', '단양군']
		  , '충청남도': ['천안시', '공주시', '보령시', '아산시', '서산시', '논산시', '계롱시', '당진시', '금산군', '부여군', '서천군', '청양군', '홍성군', '예산군', '태안군']
		  , '전북특별자치도': ['전주시', '군산시', '익산시', '정읍시', '남원시', '김제시', '진안군', '무주군', '장수군', '임실군', '순창군', '고창군', '부안군']
		  , '전라남도': ['목포시', '여수시', '순천시', '나주시', '광양시', '담양군', '곡성군', '구례군', '고흥군', '보성군', '화순군', '장흥군', '강진군', '해남군', '영암군', '무안군', 
		  				'함평군', '영광군', '장성군', '완도군', '진도군', '신안군']
		  , '경상북도': ['포항시', '경주시', '김천시', '안동시', '구미시', '영주시', '영천시', '상주시', '문경시', '경산시', '의성군', '청송군', '영양군', '영덕군',
		  				'청도군', '고령군', '성주군', '칠곡군', '예천군', '봉화군', '울진군', '울릉군']
		  , '경상남도': ['창원시', '진주시', '통영시', '사천시', '김해시', '밀양시', '거제시', '양산시', '마산시', '의령군', '함안군', '창녕군', '고성군', '남해군', 
		  				'하동군', '산청군', '함양군', '거창군', '합천군']
		  , '부산광역시': ['중구', '서구', '동구', '남구', '북구', '영도구', '부산진구', '동래구', '강서구', '해운대구', '사하구', '금정구', '연제구', '수영구', '사상구', '기장군']
		  , '대구광역시': ['중구', '동구', '서구', '남구', '북구', '수성구', '달서구', '달성군', '군위군']
		  , '인천광역시': ['중구', '동구', '서구', '미추홀구', '연수구', '남동구', '부평구', '계양구', '강화군', '옹진군']
		  , '광주광역시': ['동구', '서구', '중구', '북구', '광산구']
		  , '대전광역시': ['중구', '서구', '동구', '유성구', '대덕구']
		  , '울산광역시': ['중구', '남구', '동구', '북구', '울주군']
		  , '세종특별자치시': ['조치원읍', '연기면', '연동면', '부강면', '금남면', '장군면', '연서면', '전의면', '전동면', '소정면', '한솔동', '새롬동', '', '', '', '', '', '']			
		  , '제주특별자치도': ['제주시', '서귀포시']			
    	};		
		const citySelect = document.getElementById("city");
		const districtSelect = document.getElementById("district");

		const selectedCity = citySelect.value;
		
		 districtSelect.innerHTML = "<option value=\"\">=== 구 선택 ===</option>";
		
		if(selectedCity && districts[selectedCity]) {
			districts[selectedCity].forEach(district => {
				const option = document.createElement("option");
				option.value = district;
				option.textContent = district;
				districtSelect.appendChild(option);
			});
		}	
		selectAddress();
    }
	
</script>

</html>