<!DOCTYPE html>
<html lang="ko-KR" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- meta_tag include -->
    <head th:insert="~{layouts/meta_tag :: headMeta}"></head>
    <title>클럽 가입</title>

    <!-- 공통 css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.3/litera/bootstrap.min.css" integrity="sha512-TUtnNUXMMWp2IALAR9t2z1vuorOUQL4dPWG3J9ANInEj6xu/rz5fzni/faoEGzuqeY1Z1yGD6COYAW72oiDVYA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" th:href="@{/css/common.css}">
    <!-- 여기에 본인 css 작성해주세요 (detail_hj.css) -->
    <!-- Linking CSS files -->
    <link rel="stylesheet" th:href="@{/css/detail_hj.css}"/>
    <link rel="stylesheet" th:href="@{/css/detail_yj.css}"/>

    <!-- 공통 js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
   
</head>
<body>
    <div th:insert="~{layouts/header :: header}"></div>
    
    <main class="container main">
<!--         <h5><b>어떤 클럽을 만들까요?</b></h5> -->
    
        <form id="clubcreate" action="/club/club_create" method="post">
            
            <label for="club-name">클럽명	</label>
            	<input type="text" name="clubName" id="clubName" placeholder="클럽명" maxlength="10"></input>
            	
            <label for="club-name">클럽방장</label>
            	<input type="text" name="memId" id="memId" th:value="${#authentication.principal.MEM_ID}" readonly></input>

		    <label for="club-exercise">선호 운동 코드</label>
				<div class="exercise-container">
				    <div class="exercise-selection">
				        <input type="hidden" id="clubExercise" name="clubExercise" />				
					        <button type="button" onclick="selectExercise(this)" value="EXE_BADMINTON">배드민턴</button>
					        <button type="button" onclick="selectExercise(this)" value="EXE_BASEBALL">야구</button>
				            <button type="button" onclick="selectExercise(this)" value="EXE_BASKET">농구</button>
				            <button type="button" onclick="selectExercise(this)" value="EXE_CLIMB">암벽등반</button>
				            <button type="button" onclick="selectExercise(this)" value="EXE_FOOTBALL">축구</button>
				            <button type="button" onclick="selectExercise(this)" value="EXE_FUTSAL">풋살</button>
				            <button type="button" onclick="selectExercise(this)" value="EXE_FITNESS">헬스</button>
				            <button type="button" onclick="selectExercise(this)" value="EXE_MOUNT">등산</button>
				            <button type="button" onclick="selectExercise(this)" value="EXE_PILATES">필라테스</button>
				            <button type="button" onclick="selectExercise(this)" value="EXE_TENNIS">테니스</button>
				            <button type="button" onclick="selectExercise(this)" value="EXE_YOGA">요가</button>
			        </div>
			    </div>		    
			    		    
			<label for="club-theme">클럽 테마</label>
	           	<div class="theme-container">
				    <div class="theme-selection">
				    	<input type="hidden" id="clubTheme" name="clubTheme" />		
							<button type="button" onclick="selectTheme(this)" value="THM_SPORTCLUB">운동클럽</button>
							<button type="button" onclick="selectTheme(this)" value="THM_SPORTJOURNAL">운동일지</button>
							<button type="button" onclick="selectTheme(this)" value="THM_FOOD">영양제/식단</button>
							<button type="button" onclick="selectTheme(this)" value="THM_FITNESS">헬스</button>
							<button type="button" onclick="selectTheme(this)" value="THM_DIET">체중감량</button>
							<button type="button" onclick="selectTheme(this)" value="THM_BODYPROFILE">바디프로필</button>
							<button type="button" onclick="selectTheme(this)" value="THM_RECOVER">부상/재활</button>
							<button type="button" onclick="selectTheme(this)" value="THM_CONTEST">대회준비</button>
							<button type="button" onclick="selectTheme(this)" value="THM_EXAM">입시준비</button>
				    </div>
				</div>

            <label for="club-description">클럽 소개</label>
            	<div class="club-intro-container">
              	  <textarea name="clubIntroduction" id="clubIntroduction" maxlength="500" rows="5" placeholder="활동 중심으로 모임을 소개해주세요. 모임 설정에서 언제든지 바꿀 수 있어요."></textarea>
				</div>
            
			<!-- 사진 추가 -->
            <label for="club-image">대표 이미지</label>
			 <div class="club-image-container">
			    <div class="club-image-upload">
			 		<label for="clubImage1">   	
			           <img id="photo-upload-1" src="/img/plus_icon.png" alt="대표이미지1" class="default-icon">
			        </label>
			        <input id="clubImage1" name="clubImage1" type="file" accept="image/*" onchange="previewImage(event, 'photo-upload-1')" style="display: none;" />
			    </div>
			    <div class="club-image-upload">
			 		<label for="clubImage2">   	
			           <img id="photo-upload-2" src="/img/plus_icon.png" alt="대표이미지2" class="default-icon">
			        </label>
			        <input id="clubImage2" name="clubImage2" type="file" accept="image/*" onchange="previewImage(event, 'photo-upload-2')" style="display: none;" />
			    </div>
			    <div class="club-image-upload">
			    	<label for="clubImage3">   	
			           <img id="photo-upload-3" src="/img/plus_icon.png" alt="대표이미지3" class="default-icon">
			        </label>
			        <input id="clubImage3" name="clubImage3" type="file" accept="image/*" onchange="previewImage(event, 'photo-upload-3')" style="display: none;" />
			    </div>
			    
			    <div class="club-image-upload">
			   	 	<label for="clubImage4">   	
			           <img id="photo-upload-4" src="/img/plus_icon.png" alt="대표이미지4" class="default-icon">
			        </label>
			        <input id="clubImage4" name="clubImage4" type="file" accept="image/*" onchange="previewImage(event, 'photo-upload-4')" style="display: none;" />
			    </div>
			</div>

			<!-- 이미지 추가
			<label for="club-image">대표 이미지</label>
				<div class="club-image-container">
				 	<input type="file" id="clubImage1" name="clubImage1" accept="image/*">
				 	<input type="file" id="clubImage2" name="clubImage2" accept="image/*">
				 	<input type="file" id="clubImage3" name="clubImage3" accept="image/*">
				 	<input type="file" id="clubImage4" name="clubImage4" accept="image/*">
				</div>
				-->    
			    
			<!-- 주활동지역 -->
			<label for="club-address">주활동지역</label>
            	<input type="text" id="clubAddress" name="clubAddress" placeholder="ex) 서울시 강남구 "></input>
			
			<!-- 클럽 공개여부 / 비밀번호 -->
			<label for="club-isprivate">클럽 공개여부</label>
			<div class="club-isprivate">
			    <input type="radio" id="clubIsprivateNo" name="clubIsprivate" th:value="false" onchange="togglePasswordField()"> 공개
			    <input type="radio" id="clubIsprivateYes" name="clubIsprivate" th:value="true" onchange="togglePasswordField()"> 비공개
			    <input type="password" id="clubPw" name="clubPw" placeholder="비밀번호 입력" style="display: none; margin-left: 10px;">
			</div>

			<button type="submit" class="btn btn-primary mt-4" style="margin-bottom: 20px;">만들기</button>	
            <button type="reset" class="btn btn-secondary mt-4" style="margin-bottom: 20px;">새로고침</button>
        </form>
	</main>
    <div th:insert="~{layouts/footer :: footer}"></div>
</body>

 <script>
    // 선호운동 버튼
    function selectExercise(button) {
        document.getElementById('clubExercise').value = button.value;

        const exercisebuttons = document.querySelectorAll('.exercise-selection button');
        exercisebuttons.forEach(btn => btn.classList.remove('selected'));
        button.classList.add('selected');
    }
    
    // 운동테마 버튼
	function selectTheme(button) {
	    const themevalue = document.getElementById('clubTheme'); 
	    let selectedThemes = themevalue.value ? themevalue.value.split(',') : [];

	    if (button.classList.contains('selected')) {
	        selectedThemes = selectedThemes.filter(theme => theme !== button.value);
	        button.classList.remove('selected');
	    } else {
	        selectedThemes.push(button.value);
	        button.classList.add('selected');
	    }
	    themevalue.value = selectedThemes.join(',');
	}
	
    // 클럽 공개여부 비밀번호
    function togglePasswordField() {
        const isPrivate = document.getElementById('clubIsprivateYes').checked;
        const passwordField = document.getElementById('clubPw');
        if (isPrivate) {
            passwordField.style.display = 'inline-block'; 
        } else {
            passwordField.style.display = 'none'; 
            passwordField.value= '';
        }
    }
    
 // 이미지 업로드
	 const imageUpload = document.getElementById('clubImageUpload');
    const imagePreview = document.getElementById('imagePreview');
    const hiddenFileInputs = document.getElementById('hiddenFileInputs');

    imageUpload.addEventListener('change', function () {
        const files = Array.from(this.files);
        imagePreview.innerHTML = ''; // 기존 미리보기 초기화
        hiddenFileInputs.innerHTML = ''; // 기존 숨겨진 input 초기화

        files.forEach((file, index) => {
            const reader = new FileReader();
            reader.onload = function (e) {
                // 이미지 미리보기 생성
                const imgElement = document.createElement('img');
                imgElement.src = e.target.result;
                imgElement.alt = file.name;
                imgElement.classList.add('img-thumbnail', 'me-2', 'mb-2');
                imgElement.style.width = '150px';
                imagePreview.appendChild(imgElement);

                // 숨겨진 input 필드 생성
                const hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.name = `imageFiles[${index}]`;
                hiddenInput.value = e.target.result.split(',')[1]; // Base64 문자열만 저장
                hiddenFileInputs.appendChild(hiddenInput);
            };
            reader.readAsDataURL(file);
        });
    });
    
    /*
    function submitClub() {
    	const formData = new FormData();
    	
 		form.append("clubName", document.getElementById("clubName").value),
  		form.append("memId", document.getElementById("memId").value),
  		form.append("clubIntroduction", document.getElementById("clubIntroduction").value)
			
    	const imageInputs = ["clubImage1", "clubImage2", "clubImage3", "clubImage4"];
    	imageInputs.forEach(id => {
    		const fileInput = document.getElementById(id);
    		if(fileInput.files.length > 0) {
    			formData.append("files", fileInput.files[0]);
    		}
    	});
    	
    	fetch("/club_creat", {
    		method: "POST",
			body : formData
    	})
		
		.then(response => {
			if(!response.ok) throw new Error("클럽 생성 실패");
			return response.json();
		})
		.then(result => {
			alert("클럽 생성 완료 : 클럽코드 " + result.clubCode);
		})
		.catch(error => console.error("오류 발생", error));
    }
	*/
    
	// 클럽사진 미리보기
	    function previewImage(event, targetId) {
	        const reader = new FileReader();
	        reader.onload = function () {
	            const preview = document.getElementById(targetId);
	            preview.src = reader.result; 
	            preview.classList.remove('default-icon'); 

	        };
	        reader.readAsDataURL(event.target.files[0]);
	    }
	    
		/*
    // 클럽 이미지
	function uploadAndPreviewImage(event, index) {
    const fileInput = event.target;
    const formData = new FormData();
    formData.append("files", fileInput.files[0]); // 업로드할 파일 추가

    // 파일 업로드 요청
    fetch("/upload", {
        method: "POST",
        body: formData
    })
    .then(response => response.json())
    .then(result => {
        if (result && result.length > 0) {
            const previewImage = document.getElementById(`photo-upload-${index}`);
            const imageUrl = `/club/view/${result[0].uuid}_${result[0].fileName}`;
            previewImage.src = imageUrl; // 미리보기 이미지 업데이트
            previewImage.classList.remove("default-icon");
        }
    })
    .catch(error => console.error("업로드 중 오류 발생:", error));
}
    */
		
</script>

</html>