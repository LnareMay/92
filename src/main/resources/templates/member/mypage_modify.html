<!DOCTYPE html>
<html lang="ko-KR" xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">

<head>
	<!-- meta_tag include -->

	<head th:insert="~{layouts/meta_tag :: headMeta}"></head>
	<title></title>

	<!-- 공통 css -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.3/litera/bootstrap.min.css"
		integrity="sha512-TUtnNUXMMWp2IALAR9t2z1vuorOUQL4dPWG3J9ANInEj6xu/rz5fzni/faoEGzuqeY1Z1yGD6COYAW72oiDVYA=="
		crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" th:href="@{/css/common.css}">

	<!-- 여기에 본인 css 작성해주세요 (detail_hj.css) -->
	<!-- Linking CSS files -->
	<link rel="stylesheet" th:href="@{/css/detail_hj.css}" />

	<!-- 공통 js -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
		crossorigin="anonymous"></script>

</head>

<body>
	<div th:insert="~{layouts/header :: header}"></div>
	<main class="main container" id="mypage_pg">
		<div class="sidebar">
			<div class="header">
				<h2 style="font-size: 20px;">마이페이지</h2>
				<!-- <button class="btn btn-danger" onclick="location.href='/member/logout'">로그아웃</button> -->
			</div>

			<a href="/member/mypage" class="active">나의정보</a> <a href="#">나의시설예약</a>
			<a href="#">나의클럽</a> <a href="#">운동캘린더</a>
		</div>

		<div class="main">


			<!-- <div class="settings-navigation">
				<a href="#" class="active">Password</a> <a href="#">Team</a> <a
					href="#">Billing</a>
			</div> -->

			<!-- <div class="profile-section">
				<img src="https://via.placeholder.com/80" alt="Profile Picture">
				<div>
					<h3 th:text="${#authentication.principal.MEM_NICKNAME}"></h3>
					<p th:text="${#authentication.principal.MEM_INTRODUCTION}"></p>
				</div>
			</div> -->

			<div class="settings-form">
				<h4 style="margin-bottom: 30px;">내 정보 수정</h4>
				<form id="modifyForm" action="/member/modify" method="post">




					<div class="form-group">
						<label for="MEM_PICTURE">프로필 사진</label>
						<img id="profileImage" th:src="|/view/${#authentication.principal.MEM_PICTURE}|" alt="프로필 이미지">
						<input type="file" class="blind" id="MEM_PICTURE" name="MEM_PICTURE" accept="image/*">
					</div>

					<div class="form-group">
						<label for="MEM_ID">아이디</label> <input type="text" id="MEM_ID" name="MEM_ID"
							th:value="${#authentication.principal.MEM_ID}" class="form-control" disabled>
					</div>

					<input type="text" id="MEM_PW" name="MEM_PW" th:value="${#authentication.principal.MEM_PW}"
						class="form-control blind">

					<input type="text" id="MEM_ID" name="MEM_ID" th:value="${#authentication.principal.MEM_ID}"
						class="form-control blind">

					<div class="form-group">
						<label for="MEM_NAME">이름</label> <input type="text" id="MEM_NAME" name="MEM_NAME"
							th:value="${#authentication.principal.MEM_NAME}" class="form-control">
					</div>
					<div class="form-group">
						<label for="MEM_NICKNAME">닉네임</label> <input type="text" id="MEM_NICKNAME" name="MEM_NICKNAME"
							th:value="${#authentication.principal.MEM_NICKNAME}" class="form-control">

					</div>
					<div class="form-group">
						<label for="MEM_EXERCISE">선호하는 운동</label> <select class="form-select" id="MEM_EXERCISE"
							name="MEM_EXERCISE">
							<option th:value="${#authentication.principal.MEM_EXERCISE}"><span
									value="${#authentication.principal.MEM_EXERCISE}"></span></option>
							<option value="EXE_FOOTBALL">축구</option>
							<option value="EXE_BASKEBALL">농구</option>
							<option value="EXE_BASEBALL">야구</option>
							<option value="EXE_BADMINTON">배드민턴</option>
							<option value="EXE_TENNISL">테니스</option>
							<option value="EXE_FUTSAL">풋살</option>
							<option value="EXE_FITNESS">헬스</option>
							<option value="EXE_PILATES">필라테스</option>
							<option value="EXE_YOGA">요가</option>
							<option value="EXE_CLIMB">암벽등반</option>
							<option value="EXE_MOUNT">등산</option>
						</select>
					</div>


					<div class="form-group">
						<label for="MEM_CLUB">선호하는 클럽</label> <select class="form-select" id="MEM_CLUB" name="MEM_CLUB">
							<option th:value="${#authentication.principal.MEM_CLUB}"><span
									value="${#authentication.principal.MEM_CLUB}"></span></option>
							<option value="THM_SPORTCLUB">운동클럽</option>
							<option value="THM_CONTEST">대회준비</option>
							<option value="THM_BODYPROFILE">바디프로필</option>
							<option value="THM_RECOVER">부상/재활</option>
							<option value="THM_FOOD">영양제/식단</option>
							<option value="THM_SPORTJOURNAL">운동일지</option>
							<option value="THM_EXAM">입시준비</option>
							<option value="THM_DIET">체중감량</option>
							<option value="THM_FITNESS">체중감량</option>
						</select>
					</div>

					<div class="form-group">
						<label for="MEM_INTRODUCTION">자기소개</label>
						<textarea id="MEM_INTRODUCTION" name="MEM_INTRODUCTION"
							th:value="${#authentication.principal.MEM_INTRODUCTION}" class="form-control"></textarea>
					</div>

					<div class="form-group">
						<label for="MEM_TELL">전화번호</label> <input type="tel" id="MEM_TELL" name="MEM_TELL"
							th:value="${#authentication.principal.MEM_TELL}" class="form-control">
					</div>

					<div class="form-group">
						<label for="MEM_EMAIL">이메일</label> <input type="email" id="MEM_EMAIL" name="MEM_EMAIL"
							th:value="${#authentication.principal.MEM_EMAIL}" class="form-control">
					</div>

					<div class="form-group">

						<label for="MEM_BIRTHDAY">생년월일</label> <input type="date" id="MEM_BIRTHDAY" name="MEM_BIRTHDAY"
							th:value="${#authentication.principal.MEM_BIRTHDAY}" class="form-control">

					</div>


					<div class="form-group">

						<label for="MEM_ZIPCODE">우편번호</label> <input type="text" id="MEM_ZIPCODE" name="MEM_ZIPCODE"
							th:value="${#authentication.principal.MEM_ZIPCODE}" class="form-control"
							style="display: inline-block; width: 50%;">
						<button type="button" class="btn btn-primary" onclick="searchPostCode()">우편번호 찾기</button>

					</div>

					<div class="form-group">
						<label for="MEM_ADDRESS">주소</label> <input type="text" id="MEM_ADDRESS" name="MEM_ADDRESS"
							th:value="${#authentication.principal.MEM_ADDRESS}" class="form-control">
					</div>

					<div class="form-group">
						<label for="MEM_ADDRESS_DETAIL">상세 주소</label> <input type="text" id="MEM_ADDRESS_DETAIL"
							name="MEM_ADDRESS_DETAIL" th:value="${#authentication.principal.MEM_ADDRESS_DETAIL}"
							class="form-control">
					</div>


					<div class="form-actions">
						<!-- <button type="button" class="btn btn-primary">취소</button> -->
						<button type="submit" class="btn btn-primary">수정하기</button>
					</div>
				</form>
			</div>
		</div>


	</main>

	<div th:insert="~{layouts/footer :: footer}"></div>
	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
	<script src="/js/upload.js"></script>
	<script>
	    // 프로필 이미지 클릭 시 파일 선택 창 열기
	    const profileImage = document.getElementById('profileImage');
	    const fileInput = document.getElementById('MEM_PICTURE');

	    // 현재 파일 이름을 저장 (초기값 설정)
	    let currentFileName = "${#authentication.principal.MEM_PICTURE}";

	    profileImage.addEventListener('click', () => {
	        fileInput.click(); // 숨겨진 파일 입력 클릭
	    });

	    // 파일 선택 후 미리보기와 업로드
	    fileInput.addEventListener('change', (e) => {
	        const formObj = new FormData();
	        const files = fileInput.files;
	        const file = files.length > 0 ? files[0] : null; // 파일이 선택되지 않은 경우 null

	        if (!file) {
	            console.log("파일이 선택되지 않았습니다.");
	            return; // 파일이 없으면 작업 중단
	        }

	        const newFileName = file.name; // 선택된 파일 이름

	        // 파일 이름이 동일하면 작업 중단
	        if (newFileName === currentFileName) {
	            console.log("선택한 파일이 현재 파일과 동일합니다.");
	            alert("선택한 파일이 현재 파일과 동일합니다.");
	            return;
	        }

	        // 이미지 미리보기 설정
	        const reader = new FileReader();
	        reader.onload = function (event) {
	            profileImage.src = event.target.result; // 이미지 src 업데이트
	        };
	        reader.readAsDataURL(file);

	        // 파일 데이터를 FormData에 추가
	        formObj.append("files", file);

	        // 기존 이미지 삭제 및 새 이미지 업로드
	        removeFileToServer(currentFileName)
	            .then(() => {
	                // 서버로 새 이미지 업로드 요청
	                return uploadToServer(formObj);
	            })
	            .then(result => {
	                console.log("업로드 성공:", result);
	                alert("이미지가 업로드되었습니다.");
	                currentFileName = newFileName; // 현재 파일 이름 갱신
	            })
	            .catch(e => {
	                console.error("작업 실패:", e);
	                alert("이미지 업로드 및 삭제 중 오류가 발생했습니다.");
	            });
	    });
	</script>



</body>

</html>